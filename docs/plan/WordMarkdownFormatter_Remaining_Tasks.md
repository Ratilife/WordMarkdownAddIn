# Оставшиеся задачи по реализации модуля WordMarkdownFormatter

## Статус реализации

### ✅ Реализовано

#### Классы и структуры:
- ✅ `MarkdownElementType` (enum) - все типы элементов
- ✅ `MarkdownPatternMatcher` - класс для поиска
- ✅ `MarkdownElementFormatter` - класс для форматирования
- ✅ `FormattingContext` - вспомогательный класс (создан, но не используется активно)
- ✅ `WordMarkdownFormatter` - основной класс
- ✅ `MarkdownElementMatch` - структура данных

#### Методы поиска (MarkdownPatternMatcher):
- ✅ `FindHeadings()` - поиск заголовков
- ✅ `FindBoldText()` - поиск жирного текста
- ✅ `FindItalicText()` - поиск курсива
- ✅ `FindStrikethroughText()` - поиск зачеркнутого текста
- ✅ `FindInlineCode()` - поиск инлайн-кода
- ✅ `FindCodeBlocks()` - поиск блоков кода
- ✅ `FindLinks()` - поиск ссылок
- ✅ `FindListItems()` - поиск элементов списков
- ✅ `FindQuotes()` - поиск цитат
- ✅ `FindHorizontalRules()` - поиск горизонтальных линий
- ✅ `FindTables()` - поиск таблиц (упрощенная версия)

#### Методы форматирования (MarkdownElementFormatter):
- ✅ `FormatHeading()` - форматирование заголовков
- ✅ `FormatBoldText()` - форматирование жирного текста
- ✅ `FormatItalicText()` - форматирование курсива
- ✅ `FormatStrikethroughText()` - форматирование зачеркнутого текста
- ✅ `FormatInlineCode()` - форматирование инлайн-кода
- ✅ `FormatCodeBlock()` - форматирование блоков кода
- ✅ `FormatLink()` - форматирование ссылок
- ✅ `FormatListItem()` - форматирование списков
- ✅ `FormatQuote()` - форматирование цитат
- ✅ `FormatTable()` - форматирование таблиц (упрощенная версия)
- ✅ `LogError()` - логирование ошибок

#### Публичные методы (WordMarkdownFormatter):
- ✅ `FormatMarkdownInWord()` - главный метод форматирования
- ✅ `FormatSelectedText()` - форматирование выделенного текста
- ✅ `FormatEntireDocument()` - форматирование всего документа
- ✅ `CanFormat()` - проверка возможности форматирования

#### Приватные методы (WordMarkdownFormatter):
- ✅ `FindAllMarkdownElements()` - поиск всех элементов
- ✅ `ApplyFormattingToElement()` - применение форматирования к элементу
- ✅ `ValidateDocument()` - валидация документа
- ✅ `LogError()` - логирование ошибок
- ✅ `ResetProcessingState()` - сброс состояния
- ✅ `FilterOverlappingElements()` - фильтрация перекрывающихся элементов

---

## ❌ Не реализовано

### 1. Метод `FormatHorizontalRule()` в классе `MarkdownElementFormatter`

**Описание:** Метод для форматирования горизонтальных линий (---, ***, ___)

**Текущее состояние:** В `ApplyFormattingToElement()` есть только комментарий:
```csharp
case MarkdownElementType.HorizontalRule:
    // Горизонтальные линии можно обработать отдельно
    // Например, вставить разделитель или пустой параграф
    break;
```

**Что нужно сделать:**
- Создать метод `FormatHorizontalRule(MarkdownElementMatch element, Range documentRange)` в классе `MarkdownElementFormatter`
- Реализовать логику:
  1. Получить диапазон горизонтальной линии в документе
  2. Удалить символы `---`, `***` или `___`
  3. Вставить горизонтальную линию Word (границу параграфа) или создать пустой параграф с разделителем
  4. Применить форматирование (например, границу снизу параграфа)

**Приоритет:** Средний (горизонтальные линии используются реже других элементов)

---

### 2. Метод `RemoveMarkdownSyntax()` в классе `MarkdownElementFormatter`

**Описание:** Вспомогательный метод для удаления синтаксических маркеров из текста

**Текущее состояние:** Не реализован

**Что нужно сделать:**
- Создать метод `RemoveMarkdownSyntax(Range range, string syntaxToRemove)` в классе `MarkdownElementFormatter`
- Реализовать логику:
  1. Поиск подстроки `syntaxToRemove` в диапазоне
  2. Удаление найденной подстроки
  3. Обновление диапазона

**Примечание:** Этот метод может быть полезен для унификации удаления синтаксиса, но сейчас каждый метод `Format*` удаляет синтаксис самостоятельно. Метод не является критичным, но может улучшить читаемость кода.

**Приоритет:** Низкий (можно реализовать для улучшения кода, но не обязательно)

---

### 3. Интеграция с Ribbon (кнопка в интерфейсе)

**Описание:** Добавление кнопки в ленту Word для запуска форматирования

**Текущее состояние:** Кнопка не добавлена

**Что нужно сделать:**

#### 3.1. Добавить кнопку в `MarkdownRibbon.Designer.cs`:
- Добавить поле `btnFormatMarkdown` типа `RibbonButton`
- Добавить кнопку в группу `grpFormat` (группа "Форматирование")
- Настроить свойства кнопки (Label, Name и т.д.)
- Подписаться на событие `Click`

#### 3.2. Добавить обработчик в `MarkdownRibbon.cs`:
- Создать метод `btnFormatMarkdown_Click()`
- Реализовать логику:
  1. Проверить наличие выделенного текста
  2. Если текст выделен - вызвать `FormatSelectedText()`
  3. Если текст не выделен - спросить пользователя и вызвать `FormatEntireDocument()`
  4. Показать сообщение об успешном завершении или ошибке

**Приоритет:** Высокий (без кнопки модуль нельзя использовать)

---

### 4. Улучшение реализации таблиц

**Описание:** Полная реализация парсинга и создания таблиц Word из Markdown

**Текущее состояние:** Реализована упрощенная версия, которая только находит таблицы, но не преобразует их в таблицы Word

**Что нужно сделать:**
- Улучшить метод `FindTables()` для правильного парсинга структуры таблицы
- Улучшить метод `FormatTable()` для:
  1. Парсинга строк таблицы (разделитель `|`)
  2. Определения количества столбцов
  3. Создания таблицы Word через `Tables.Add()`
  4. Заполнения ячеек данными
  5. Применения форматирования к таблице (границы, стили)

**Приоритет:** Средний (таблицы работают частично)

---

### 5. Улучшение обработки блоков кода

**Описание:** Улучшение парсинга блоков кода с учетом языка программирования

**Текущее состояние:** Блоки кода обрабатываются, но паттерн регулярного выражения может быть улучшен

**Текущий паттерн:** `@"```(\w+)?\n([\s\S]*?)```"`
- Может не работать, если язык не указан или формат немного отличается

**Что нужно сделать:**
- Улучшить регулярное выражение для более надежного парсинга
- Обработать случаи, когда блок кода не содержит языка
- Возможно, добавить подсветку синтаксиса (если используется SyntaxHighlighter)

**Приоритет:** Низкий (базовая функциональность работает)

---

## Резюме

### Критичные задачи (необходимо для работы модуля):
1. **Интеграция с Ribbon** - добавление кнопки в интерфейс

### Важные задачи (улучшают функциональность):
2. **FormatHorizontalRule()** - форматирование горизонтальных линий
3. **Улучшение таблиц** - полная реализация преобразования таблиц

### Опциональные задачи (улучшают качество кода):
4. **RemoveMarkdownSyntax()** - унификация удаления синтаксиса
5. **Улучшение блоков кода** - более надежный парсинг

---

## Рекомендуемый порядок реализации

1. **Сначала:** Интеграция с Ribbon (кнопка) - чтобы модуль можно было использовать
2. **Затем:** FormatHorizontalRule() - для полной поддержки всех элементов Markdown
3. **Потом:** Улучшение таблиц - для полной функциональности
4. **Опционально:** RemoveMarkdownSyntax() и улучшение блоков кода

---

## Примечания

- Класс `FormattingContext` создан, но не используется активно. Можно использовать для улучшения архитектуры, но это не обязательно.
- Все основные методы реализованы и должны работать.
- Обработка ошибок реализована через `LogError()` и `Debug.WriteLine()`.
- Валидация документа реализована в `ValidateDocument()`.


